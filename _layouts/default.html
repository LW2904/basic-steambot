<!doctype html>
<html lang="{{ site.lang | default: "en-US" }}">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>{{ site.title | default: site.github.repository_name }} by {{ site.github.owner_name }}</title>

    <link rel="stylesheet" href="{{ '/assets/css/style.css?v=' | append: site.github.build_revision | relative_url }}">

    <script src="https://unpkg.com/vue"></script>

    <meta name="viewport" content="width=device-width">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>{{ site.title | default: site.github.repository_name }}</h1>
        <p>{{ site.description | default: site.github.project_tagline }}</p>

        {% if site.github.is_project_page %}
          <p class="view"><a href="{{ site.github.repository_url }}">View the Project on GitHub <small>{{ github_name }}</small></a></p>
        {% endif %}

        {% if site.github.is_user_page %}
          <p class="view"><a href="{{ site.github.owner_url }}">View My GitHub Profile</a></p>
        {% endif %}

        {% if site.show_downloads %}
          <ul>
            <li><a href="{{ site.github.zip_url }}">Download <strong>ZIP File</strong></a></li>
            <li><a href="{{ site.github.tar_url }}">Download <strong>TAR Ball</strong></a></li>
            <li><a href="{{ site.github.repository_url }}">View On <strong>GitHub</strong></a></li>
          </ul>
        {% endif %}

        <div id="app">
          <!-- <ul>
            <li v-for="record in commits">
              <a :href="record.html_url" target="_blank" class="commit">{{ record.sha.slice(0, 7) }}</a>
              - <span class="message">{{ record.commit.message | truncate}}</span><br>
              by <span class="author"><a :href="record.author.html_url" target="_blank">{{ record.commit.author.name }}</a></span>
              at <span class="date">{{ record.commit.author.date | formatDate }}</span>
            </li>
          </ul> -->
          <record v-for="record in commits" :record="record"></record>
        </div>
      </header>
      <section>

      {{ content }}

      </section>
      <footer>
        {% if site.github.is_project_page %}
        <p>This project is maintained by <a href="{{ site.github.owner_url }}">{{ site.github.owner_name }}</a></p>
        {% endif %}
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="{{ '/assets/js/scale.fix.js' | relative_url }}"></script>

    <script>
      console.log('loaded')

      let apiURL = 'https://api.github.com/repos/lw2904/basic-steambot/commits?per_page=9&sha='

      Vue.component('record', {
        props: ['record'],
        template: `
          <p>{{ record.commit.message }}</p>
        `
      })

      const app = new Vue({
        el: '#app',
        data: {
          currentBranch: 'master',
          commits: null
        },
        filters: {
          truncate: function (v) {
            let newline = v.indexOf('\n')
            return newline > 0 ? v.slice(0, newline) : v
          },
          formatDate: function (v) {
            return v.replace(/T|Z/g, ' ')
          }
        },
        methods: {
          fetchData: function () {
            let xhr = new XMLHttpRequest()
            let self = this
            xhr.open('GET', apiURL + self.currentBranch)
            xhr.onload = function () {
              self.commits = JSON.parse(xhr.responseText)
              console.log(self.commits[0].html_url)
            }
            xhr.send()
          }
        },
        mounted() {
          console.log('mounted')
          this.fetchData()
        },
        created: function () {}
      })
    </script>

  {% if site.google_analytics %}
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
        ga('create', '{{ site.google_analytics }}', 'auto');
        ga('send', 'pageview');
    </script>
  {% endif %}
  </body>
</html>
